# Парсер топ-10 фильмов с Кинопоиска

***Задача проекта - получить опыт работы со встраиваемой базой данных H2, поработать с кэшированием данных (Spring Caching) и научиться разбивать html страницу на компоненты, также углубить знания в Spring, Freemarker, Boostrap, Hibernate, Maven.***
____

Само приложение это UI где находятся 2 страницы, одна из них страница с выбором времени парсинга и серверная часть где находится парсер

![image](https://user-images.githubusercontent.com/92450565/161250707-388afc53-ba35-4d67-82d3-34df01a0bed0.png)

Вторая страница это собственно топ-10 фильмов которые были спарсены в это время с Кинопоиска. Чтобы каждый раз не загружать топ-10 из базы данных, в проекте реализовано кеширование (Spring Caching). То есть первый раз когда мы открываем приложение и проходим по всем датам, то чтобы вывести на экран сервер заходит в бд и достает оттуда данные запоминая для какой даты какие данные он достал. В дальнейшем если мы нажимаем на дату которую ранее уже открывали, то приложение дает нам список фильмов уже не из бд, а из кеша. Информация о том зашел сервер в бд или взял из кеша можно посмотреть в консоли перейдя на вкладку с датой (если уведомление в консоли, значит зашел в бд)

![image](https://user-images.githubusercontent.com/92450565/161252323-09a27a30-113f-49ba-81bc-923e53df67a4.png)


![image](https://user-images.githubusercontent.com/92450565/161250946-5950b5b6-cc90-424c-94f0-8ebb5fbab755.png)
____
В программе сам парсер сделан очень примитивно без дополнительной нагрузки в заголовок запроса. Парсер с Кинопоиска запускается автоматически каждые 15 минут (Spring Scheduling время работы парсера для примера: 10:15, 10:30, 10:45, 11:00 и тд.) - оптимальное время, чтобы алгоритмы кинопоиска не выдавали каптчу о проверке на бота (но иногда все равно не дает спарсить). Посмотреть удачно ли отработал алгоритм можно в консоли по соответсвующему тексту 

![image](https://user-images.githubusercontent.com/92450565/161250214-5edf0d78-02fe-4121-9017-d84c5e5d4089.png)

или

![image](https://user-images.githubusercontent.com/92450565/161252936-ac3a6be2-b1a3-46eb-8b4c-96084867a94d.png)


В данном приложении была использована встаиваемая база данных H2.
Чтобы зайти в БД, нужно запустить приложение и пройти по адресу http://localhost:8080/h2-console/ и заполнить данные как показано ниже

![image](https://user-images.githubusercontent.com/92450565/161142105-aa43df88-dc4d-4f2d-8c3b-46fc9121a923.png)

Далее можем выполнить SELECT из TOP_FILMS и посмотреть что у нас хранится в бд

![image](https://user-images.githubusercontent.com/92450565/161253793-7479f083-a4b4-4973-98b8-16d62852838f.png)


____
Ссылка на [jar архив](https://docs.google.com/uc?export=download&id=1ZVIYo56X70uR5cXbpH4_Zt2PpONkPwWA) который можно запустить через консоль (перейдя в папку с jar архивом и в консоли написать):

java -jar kinopoisk-0.0.1-SNAPSHOT.jar

Далее можно открыть приложение зайдя в браузер и перейти http://localhost:8080

Чтобы зайти в БД инструкция прилагается выше (при скачивании jar архива БД будет пустая, нужно подождать чтобы парсер ее заполнил)
____
